machine:
  pre:
    - sudo apt-get update
    - sudo apt-get install gcc-4.8
    - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 90
    - gcc --version
    - sudo apt-get install libzip-dev
    - sudo pip install awscli
  services:
  ghc:
    version: 7.10.2

dependencies:
  cache_directories:
    - ~/dynamic/
    - .cabal-sandbox
    - dist/

  override:
    - cabal update
    - cabal sandbox init
    - cabal install --dependencies-only -j2 --no-upgrade-dependencies --enable-tests

deployment:
   aws:
     branch: master
     commands:
       - cabal run clean
       - cabal run build
       - cabal run deploy
       - /bin/bash publish.sh
